{"Parameters":{"CdkAndAppSourceBranchToTrack":{"Type":"String","Default":"main","NoEcho":false},"IamUserToAllowKeyMolicyManagement":{"Type":"String","NoEcho":false}},"Resources":{"CustomPipelineArtifactsBucketKeyCFAAB9DA":{"Type":"AWS::KMS::Key","Properties":{"KeyPolicy":{"Statement":[{"Action":["kms:Create*","kms:Describe*","kms:Enable*","kms:List*","kms:Put*","kms:Update*","kms:Revoke*","kms:Disable*","kms:Get*","kms:Delete*","kms:ScheduleKeyDeletion","kms:CancelKeyDeletion","kms:GenerateDataKey","kms:TagResource","kms:UntagResource"],"Effect":"Allow","Principal":{"AWS":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::",{"Ref":"AWS::AccountId"},":root"]]}},"Resource":"*"},{"Action":["kms:Create*","kms:Describe*","kms:Enable*","kms:List*","kms:Put*","kms:Update*","kms:Revoke*","kms:Disable*","kms:Get*","kms:Delete*","kms:TagResource","kms:UntagResource","kms:ScheduleKeyDeletion","kms:CancelKeyDeletion"],"Effect":"Allow","Principal":{"AWS":["arn:aws:iam::892799438830:user/noce2-dev",{"Ref":"IamUserToAllowKeyMolicyManagement"}]},"Resource":"*","Sid":"allow user access to update key policies"},{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["PipelineRoleD68726F7","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["LambdaBuildRole40E116C6","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["LambdaBuildRole40E116C6","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CdkBuildRoleBE66F777","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CdkBuildRoleBE66F777","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:DescribeKey"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployRole051AFE96","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:DescribeKey"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployCodePipelineActionRoleF706AF66","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:DescribeKey"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployRole3344D815","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:DescribeKey"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployCodePipelineActionRole8F95B52B","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["WebUIBuildRole3CE8BDFB","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["WebUIBuildRole3CE8BDFB","Arn"]}},"Resource":"*"},{"Action":["kms:Decrypt","kms:DescribeKey"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["PipelineDeployWebAppSourceCodeWebUICodeUploadCodePipelineActionRoleB7E478D1","Arn"]}},"Resource":"*"}],"Version":"2012-10-17"}},"UpdateReplacePolicy":"Delete","DeletionPolicy":"Delete","Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/CustomPipelineArtifactsBucketKey/Resource"}},"PipelineArtifactsBucketC4BB9BE3":{"Type":"AWS::S3::Bucket","Properties":{"BucketEncryption":{"ServerSideEncryptionConfiguration":[{"ServerSideEncryptionByDefault":{"KMSMasterKeyID":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]},"SSEAlgorithm":"aws:kms"}}]}},"UpdateReplacePolicy":"Delete","DeletionPolicy":"Delete","Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/PipelineArtifactsBucket/Resource"}},"CdkBuildRoleBE66F777":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"codebuild.amazonaws.com"}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/CdkBuild/Role/Resource"}},"CdkBuildRoleDefaultPolicyD27F0F5C":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:eu-west-2:",{"Ref":"AWS::AccountId"},":log-group:/aws/codebuild/",{"Ref":"CdkBuild455F642E"}]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:eu-west-2:",{"Ref":"AWS::AccountId"},":log-group:/aws/codebuild/",{"Ref":"CdkBuild455F642E"},":*"]]}]},{"Action":["codebuild:CreateReportGroup","codebuild:CreateReport","codebuild:UpdateReport","codebuild:BatchPutTestCases","codebuild:BatchPutCodeCoverages"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":codebuild:eu-west-2:",{"Ref":"AWS::AccountId"},":report-group/",{"Ref":"CdkBuild455F642E"},"-*"]]}},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*","s3:DeleteObject*","s3:PutObject*","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},"/*"]]}]},{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},{"Action":["kms:Decrypt","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}}],"Version":"2012-10-17"},"PolicyName":"CdkBuildRoleDefaultPolicyD27F0F5C","Roles":[{"Ref":"CdkBuildRoleBE66F777"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/CdkBuild/Role/DefaultPolicy/Resource"}},"CdkBuild455F642E":{"Type":"AWS::CodeBuild::Project","Properties":{"Artifacts":{"Type":"CODEPIPELINE"},"Environment":{"ComputeType":"BUILD_GENERAL1_SMALL","Image":"aws/codebuild/standard:2.0","PrivilegedMode":false,"Type":"LINUX_CONTAINER"},"ServiceRole":{"Fn::GetAtt":["CdkBuildRoleBE66F777","Arn"]},"Source":{"BuildSpec":"{\n  \"version\": \"0.2\",\n  \"phases\": {\n    \"install\": {\n      \"commands\": [\n        \"cd infrastructure\",\n        \"npm install\"\n      ]\n    },\n    \"build\": {\n      \"commands\": [\n        \"npm run build\",\n        \"npm run cdk synth -- -o dist\"\n      ]\n    }\n  },\n  \"artifacts\": {\n    \"base-directory\": \"infrastructure/dist\",\n    \"files\": [\n      \"LambdaStack.template.json\",\n      \"WebUIStack.template.json\"\n    ]\n  }\n}","Type":"CODEPIPELINE"},"EncryptionKey":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/CdkBuild/Resource"}},"LambdaBuildRole40E116C6":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"codebuild.amazonaws.com"}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/LambdaBuild/Role/Resource"}},"LambdaBuildRoleDefaultPolicyBE23D2E1":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:eu-west-2:",{"Ref":"AWS::AccountId"},":log-group:/aws/codebuild/",{"Ref":"LambdaBuildCF1FE7ED"}]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:eu-west-2:",{"Ref":"AWS::AccountId"},":log-group:/aws/codebuild/",{"Ref":"LambdaBuildCF1FE7ED"},":*"]]}]},{"Action":["codebuild:CreateReportGroup","codebuild:CreateReport","codebuild:UpdateReport","codebuild:BatchPutTestCases","codebuild:BatchPutCodeCoverages"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":codebuild:eu-west-2:",{"Ref":"AWS::AccountId"},":report-group/",{"Ref":"LambdaBuildCF1FE7ED"},"-*"]]}},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*","s3:DeleteObject*","s3:PutObject*","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},"/*"]]}]},{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},{"Action":["kms:Decrypt","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}}],"Version":"2012-10-17"},"PolicyName":"LambdaBuildRoleDefaultPolicyBE23D2E1","Roles":[{"Ref":"LambdaBuildRole40E116C6"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/LambdaBuild/Role/DefaultPolicy/Resource"}},"LambdaBuildCF1FE7ED":{"Type":"AWS::CodeBuild::Project","Properties":{"Artifacts":{"Type":"CODEPIPELINE"},"Environment":{"ComputeType":"BUILD_GENERAL1_SMALL","Image":"aws/codebuild/standard:2.0","PrivilegedMode":false,"Type":"LINUX_CONTAINER"},"ServiceRole":{"Fn::GetAtt":["LambdaBuildRole40E116C6","Arn"]},"Source":{"BuildSpec":"{\n  \"version\": \"0.2\",\n  \"phases\": {\n    \"install\": {\n      \"commands\": [\n        \"cd backend\",\n        \"npm install\"\n      ]\n    },\n    \"build\": {\n      \"commands\": \"npm run build\"\n    }\n  },\n  \"artifacts\": {\n    \"base-directory\": \"backend\",\n    \"files\": [\n      \"index.js\",\n      \"node_modules/**/*\"\n    ]\n  }\n}","Type":"CODEPIPELINE"},"EncryptionKey":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/LambdaBuild/Resource"}},"WebUIBuildRole3CE8BDFB":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"codebuild.amazonaws.com"}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/WebUIBuild/Role/Resource"}},"WebUIBuildRoleDefaultPolicyD998F35F":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:eu-west-2:",{"Ref":"AWS::AccountId"},":log-group:/aws/codebuild/",{"Ref":"WebUIBuild0C1D8BF8"}]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:eu-west-2:",{"Ref":"AWS::AccountId"},":log-group:/aws/codebuild/",{"Ref":"WebUIBuild0C1D8BF8"},":*"]]}]},{"Action":["codebuild:CreateReportGroup","codebuild:CreateReport","codebuild:UpdateReport","codebuild:BatchPutTestCases","codebuild:BatchPutCodeCoverages"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":codebuild:eu-west-2:",{"Ref":"AWS::AccountId"},":report-group/",{"Ref":"WebUIBuild0C1D8BF8"},"-*"]]}},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*","s3:DeleteObject*","s3:PutObject*","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},"/*"]]}]},{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},{"Action":["kms:Decrypt","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}}],"Version":"2012-10-17"},"PolicyName":"WebUIBuildRoleDefaultPolicyD998F35F","Roles":[{"Ref":"WebUIBuildRole3CE8BDFB"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/WebUIBuild/Role/DefaultPolicy/Resource"}},"WebUIBuild0C1D8BF8":{"Type":"AWS::CodeBuild::Project","Properties":{"Artifacts":{"Type":"CODEPIPELINE"},"Environment":{"ComputeType":"BUILD_GENERAL1_SMALL","Image":"aws/codebuild/standard:2.0","PrivilegedMode":false,"Type":"LINUX_CONTAINER"},"ServiceRole":{"Fn::GetAtt":["WebUIBuildRole3CE8BDFB","Arn"]},"Source":{"BuildSpec":"{\n  \"version\": \"0.2\",\n  \"phases\": {\n    \"install\": {\n      \"commands\": [\n        \"cd web-app\",\n        \"npm install\"\n      ]\n    },\n    \"build\": {\n      \"commands\": [\n        \"npm run-script configure-environment-url -- --url ${BackendLambdaUrl} --configuration production\",\n        \"npm run build:prod\"\n      ]\n    }\n  },\n  \"artifacts\": {\n    \"base-directory\": \"web-app/dist/web-app\",\n    \"files\": [\n      \"index.html\",\n      \"favicon.ico\",\n      \"*.js\",\n      \"*.js.map\",\n      \"*.css\"\n    ]\n  }\n}","Type":"CODEPIPELINE"},"EncryptionKey":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/WebUIBuild/Resource"}},"PipelineRoleD68726F7":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"codepipeline.amazonaws.com"}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Role/Resource"}},"PipelineRoleDefaultPolicyC7A05455":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*","s3:DeleteObject*","s3:PutObject*","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},"/*"]]}]},{"Action":["kms:Decrypt","kms:DescribeKey","kms:Encrypt","kms:ReEncrypt*","kms:GenerateDataKey*"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},{"Action":"sts:AssumeRole","Effect":"Allow","Resource":{"Fn::GetAtt":["PipelineBuildLambdaSourceandCDKAppsLambdaBuildCodePipelineActionRoleFD529E5D","Arn"]}},{"Action":"sts:AssumeRole","Effect":"Allow","Resource":{"Fn::GetAtt":["PipelineBuildLambdaSourceandCDKAppsCDKBuildCodePipelineActionRoleAD31AA13","Arn"]}},{"Action":"sts:AssumeRole","Effect":"Allow","Resource":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployCodePipelineActionRoleF706AF66","Arn"]}},{"Action":"sts:AssumeRole","Effect":"Allow","Resource":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployCodePipelineActionRole8F95B52B","Arn"]}},{"Action":"sts:AssumeRole","Effect":"Allow","Resource":{"Fn::GetAtt":["PipelineBuildWebAppSourceCodeWebUIBuildCodePipelineActionRoleE47670F1","Arn"]}},{"Action":"sts:AssumeRole","Effect":"Allow","Resource":{"Fn::GetAtt":["PipelineDeployWebAppSourceCodeWebUICodeUploadCodePipelineActionRoleB7E478D1","Arn"]}}],"Version":"2012-10-17"},"PolicyName":"PipelineRoleDefaultPolicyC7A05455","Roles":[{"Ref":"PipelineRoleD68726F7"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Role/DefaultPolicy/Resource"}},"PipelineC660917D":{"Type":"AWS::CodePipeline::Pipeline","Properties":{"RoleArn":{"Fn::GetAtt":["PipelineRoleD68726F7","Arn"]},"Stages":[{"Actions":[{"ActionTypeId":{"Category":"Source","Owner":"ThirdParty","Provider":"GitHub","Version":"1"},"Configuration":{"Owner":"noce2","Repo":"aws-weather-app","Branch":{"Ref":"CdkAndAppSourceBranchToTrack"},"OAuthToken":"{{resolve:secretsmanager:arn:aws:secretsmanager:eu-west-2:892799438830:secret:prod/aws-weather-app/github-nYjmSc:SecretString:github-access-token::}}","PollForSourceChanges":false},"Name":"Clone_aws-weather-app_repo","OutputArtifacts":[{"Name":"Artifact_Source_Clone_aws-weather-app_repo"}],"RunOrder":1}],"Name":"Source"},{"Actions":[{"ActionTypeId":{"Category":"Build","Owner":"AWS","Provider":"CodeBuild","Version":"1"},"Configuration":{"ProjectName":{"Ref":"LambdaBuildCF1FE7ED"}},"InputArtifacts":[{"Name":"Artifact_Source_Clone_aws-weather-app_repo"}],"Name":"Lambda_Build","OutputArtifacts":[{"Name":"LambdaBuildOutput"}],"RoleArn":{"Fn::GetAtt":["PipelineBuildLambdaSourceandCDKAppsLambdaBuildCodePipelineActionRoleFD529E5D","Arn"]},"RunOrder":1},{"ActionTypeId":{"Category":"Build","Owner":"AWS","Provider":"CodeBuild","Version":"1"},"Configuration":{"ProjectName":{"Ref":"CdkBuild455F642E"}},"InputArtifacts":[{"Name":"Artifact_Source_Clone_aws-weather-app_repo"}],"Name":"CDK_Build","OutputArtifacts":[{"Name":"CdkBuildOutput"}],"RoleArn":{"Fn::GetAtt":["PipelineBuildLambdaSourceandCDKAppsCDKBuildCodePipelineActionRoleAD31AA13","Arn"]},"RunOrder":1}],"Name":"Build_Lambda_Source_and_CDK_Apps"},{"Actions":[{"ActionTypeId":{"Category":"Deploy","Owner":"AWS","Provider":"CloudFormation","Version":"1"},"Configuration":{"StackName":"LambdaDeploymentStack","Capabilities":"CAPABILITY_NAMED_IAM","RoleArn":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployRole051AFE96","Arn"]},"ParameterOverrides":"{\"LambdaLambdaSourceBucketNameParameter159473FC\":{\"Fn::GetArtifactAtt\":[\"LambdaBuildOutput\",\"BucketName\"]},\"LambdaLambdaSourceObjectKeyParameter06573F1D\":{\"Fn::GetArtifactAtt\":[\"LambdaBuildOutput\",\"ObjectKey\"]}}","ActionMode":"CREATE_UPDATE","TemplatePath":"CdkBuildOutput::LambdaStack.template.json"},"InputArtifacts":[{"Name":"LambdaBuildOutput"},{"Name":"CdkBuildOutput"}],"Name":"Lambda_CFN_Deploy","Namespace":"Lambda_CFN_Deploy_Namespace","RoleArn":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployCodePipelineActionRoleF706AF66","Arn"]},"RunOrder":1},{"ActionTypeId":{"Category":"Deploy","Owner":"AWS","Provider":"CloudFormation","Version":"1"},"Configuration":{"StackName":"WebUIStack","Capabilities":"CAPABILITY_NAMED_IAM","RoleArn":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployRole3344D815","Arn"]},"ActionMode":"CREATE_UPDATE","TemplatePath":"CdkBuildOutput::WebUIStack.template.json"},"InputArtifacts":[{"Name":"CdkBuildOutput"}],"Name":"WebUI_CFN_Deploy","Namespace":"WebUI_CFN_Deploy_Namespace","RoleArn":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployCodePipelineActionRole8F95B52B","Arn"]},"RunOrder":1}],"Name":"Deploy_Lambda_Infra_and_Web_App_Infra"},{"Actions":[{"ActionTypeId":{"Category":"Build","Owner":"AWS","Provider":"CodeBuild","Version":"1"},"Configuration":{"ProjectName":{"Ref":"WebUIBuild0C1D8BF8"},"EnvironmentVariables":"[{\"name\":\"BackendLambdaUrl\",\"type\":\"PLAINTEXT\",\"value\":\"#{Lambda_CFN_Deploy_Namespace.apiurl}\"}]"},"InputArtifacts":[{"Name":"Artifact_Source_Clone_aws-weather-app_repo"}],"Name":"WebUI_Build","OutputArtifacts":[{"Name":"WebUIBuildOutput"}],"RoleArn":{"Fn::GetAtt":["PipelineBuildWebAppSourceCodeWebUIBuildCodePipelineActionRoleE47670F1","Arn"]},"RunOrder":1}],"Name":"Build_Web_App_Source_Code"},{"Actions":[{"ActionTypeId":{"Category":"Deploy","Owner":"AWS","Provider":"S3","Version":"1"},"Configuration":{"BucketName":{"Fn::ImportValue":"WebUIStack:ExportsOutputRefnoce2devawsweatherappwebuibucket554E74B85EE067B9"},"Extract":"true"},"InputArtifacts":[{"Name":"WebUIBuildOutput"}],"Name":"WebUI_Code_Upload","RoleArn":{"Fn::GetAtt":["PipelineDeployWebAppSourceCodeWebUICodeUploadCodePipelineActionRoleB7E478D1","Arn"]},"RunOrder":1}],"Name":"Deploy_Web_App_Source_Code"}],"ArtifactStore":{"EncryptionKey":{"Id":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]},"Type":"KMS"},"Location":{"Ref":"PipelineArtifactsBucketC4BB9BE3"},"Type":"S3"}},"DependsOn":["PipelineRoleDefaultPolicyC7A05455","PipelineRoleD68726F7"],"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Resource"}},"PipelineSourceCloneawsweatherapprepoWebhookResourceE2DD45C5":{"Type":"AWS::CodePipeline::Webhook","Properties":{"Authentication":"GITHUB_HMAC","AuthenticationConfiguration":{"SecretToken":"{{resolve:secretsmanager:arn:aws:secretsmanager:eu-west-2:892799438830:secret:prod/aws-weather-app/github-nYjmSc:SecretString:github-access-token::}}"},"Filters":[{"JsonPath":"$.ref","MatchEquals":"refs/heads/{Branch}"}],"TargetAction":"Clone_aws-weather-app_repo","TargetPipeline":{"Ref":"PipelineC660917D"},"TargetPipelineVersion":1,"RegisterWithThirdParty":true},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Source/Clone_aws-weather-app_repo/WebhookResource"}},"PipelineBuildLambdaSourceandCDKAppsLambdaBuildCodePipelineActionRoleFD529E5D":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"AWS":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::",{"Ref":"AWS::AccountId"},":root"]]}}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Build_Lambda_Source_and_CDK_Apps/Lambda_Build/CodePipelineActionRole/Resource"}},"PipelineBuildLambdaSourceandCDKAppsLambdaBuildCodePipelineActionRoleDefaultPolicy120C50C9":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":["codebuild:BatchGetBuilds","codebuild:StartBuild","codebuild:StopBuild"],"Effect":"Allow","Resource":{"Fn::GetAtt":["LambdaBuildCF1FE7ED","Arn"]}}],"Version":"2012-10-17"},"PolicyName":"PipelineBuildLambdaSourceandCDKAppsLambdaBuildCodePipelineActionRoleDefaultPolicy120C50C9","Roles":[{"Ref":"PipelineBuildLambdaSourceandCDKAppsLambdaBuildCodePipelineActionRoleFD529E5D"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Build_Lambda_Source_and_CDK_Apps/Lambda_Build/CodePipelineActionRole/DefaultPolicy/Resource"}},"PipelineBuildLambdaSourceandCDKAppsCDKBuildCodePipelineActionRoleAD31AA13":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"AWS":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::",{"Ref":"AWS::AccountId"},":root"]]}}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Build_Lambda_Source_and_CDK_Apps/CDK_Build/CodePipelineActionRole/Resource"}},"PipelineBuildLambdaSourceandCDKAppsCDKBuildCodePipelineActionRoleDefaultPolicyFB30EB40":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":["codebuild:BatchGetBuilds","codebuild:StartBuild","codebuild:StopBuild"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CdkBuild455F642E","Arn"]}}],"Version":"2012-10-17"},"PolicyName":"PipelineBuildLambdaSourceandCDKAppsCDKBuildCodePipelineActionRoleDefaultPolicyFB30EB40","Roles":[{"Ref":"PipelineBuildLambdaSourceandCDKAppsCDKBuildCodePipelineActionRoleAD31AA13"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Build_Lambda_Source_and_CDK_Apps/CDK_Build/CodePipelineActionRole/DefaultPolicy/Resource"}},"PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployCodePipelineActionRoleF706AF66":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"AWS":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::",{"Ref":"AWS::AccountId"},":root"]]}}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Deploy_Lambda_Infra_and_Web_App_Infra/Lambda_CFN_Deploy/CodePipelineActionRole/Resource"}},"PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployCodePipelineActionRoleDefaultPolicy1EB0A14D":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":"iam:PassRole","Effect":"Allow","Resource":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployRole051AFE96","Arn"]}},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},"/*"]]}]},{"Action":["kms:Decrypt","kms:DescribeKey"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},{"Action":["cloudformation:CreateStack","cloudformation:DescribeStack*","cloudformation:GetStackPolicy","cloudformation:GetTemplate*","cloudformation:SetStackPolicy","cloudformation:UpdateStack","cloudformation:ValidateTemplate"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":cloudformation:eu-west-2:",{"Ref":"AWS::AccountId"},":stack/LambdaDeploymentStack/*"]]}}],"Version":"2012-10-17"},"PolicyName":"PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployCodePipelineActionRoleDefaultPolicy1EB0A14D","Roles":[{"Ref":"PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployCodePipelineActionRoleF706AF66"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Deploy_Lambda_Infra_and_Web_App_Infra/Lambda_CFN_Deploy/CodePipelineActionRole/DefaultPolicy/Resource"}},"PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployRole051AFE96":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"cloudformation.amazonaws.com"}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Deploy_Lambda_Infra_and_Web_App_Infra/Lambda_CFN_Deploy/Role/Resource"}},"PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployRoleDefaultPolicy2C1353B9":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},"/*"]]}]},{"Action":["kms:Decrypt","kms:DescribeKey"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},{"Action":"*","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"PolicyName":"PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployRoleDefaultPolicy2C1353B9","Roles":[{"Ref":"PipelineDeployLambdaInfraandWebAppInfraLambdaCFNDeployRole051AFE96"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Deploy_Lambda_Infra_and_Web_App_Infra/Lambda_CFN_Deploy/Role/DefaultPolicy/Resource"}},"PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployCodePipelineActionRole8F95B52B":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"AWS":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::",{"Ref":"AWS::AccountId"},":root"]]}}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Deploy_Lambda_Infra_and_Web_App_Infra/WebUI_CFN_Deploy/CodePipelineActionRole/Resource"}},"PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployCodePipelineActionRoleDefaultPolicy30D3E426":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":"iam:PassRole","Effect":"Allow","Resource":{"Fn::GetAtt":["PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployRole3344D815","Arn"]}},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},"/*"]]}]},{"Action":["kms:Decrypt","kms:DescribeKey"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},{"Action":["cloudformation:CreateStack","cloudformation:DescribeStack*","cloudformation:GetStackPolicy","cloudformation:GetTemplate*","cloudformation:SetStackPolicy","cloudformation:UpdateStack","cloudformation:ValidateTemplate"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":cloudformation:eu-west-2:",{"Ref":"AWS::AccountId"},":stack/WebUIStack/*"]]}}],"Version":"2012-10-17"},"PolicyName":"PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployCodePipelineActionRoleDefaultPolicy30D3E426","Roles":[{"Ref":"PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployCodePipelineActionRole8F95B52B"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Deploy_Lambda_Infra_and_Web_App_Infra/WebUI_CFN_Deploy/CodePipelineActionRole/DefaultPolicy/Resource"}},"PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployRole3344D815":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"cloudformation.amazonaws.com"}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Deploy_Lambda_Infra_and_Web_App_Infra/WebUI_CFN_Deploy/Role/Resource"}},"PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployRoleDefaultPolicyAE13D235":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},"/*"]]}]},{"Action":["kms:Decrypt","kms:DescribeKey"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}},{"Action":"*","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"PolicyName":"PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployRoleDefaultPolicyAE13D235","Roles":[{"Ref":"PipelineDeployLambdaInfraandWebAppInfraWebUICFNDeployRole3344D815"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Deploy_Lambda_Infra_and_Web_App_Infra/WebUI_CFN_Deploy/Role/DefaultPolicy/Resource"}},"PipelineBuildWebAppSourceCodeWebUIBuildCodePipelineActionRoleE47670F1":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"AWS":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::",{"Ref":"AWS::AccountId"},":root"]]}}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Build_Web_App_Source_Code/WebUI_Build/CodePipelineActionRole/Resource"}},"PipelineBuildWebAppSourceCodeWebUIBuildCodePipelineActionRoleDefaultPolicy2BD5A9E5":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":["codebuild:BatchGetBuilds","codebuild:StartBuild","codebuild:StopBuild"],"Effect":"Allow","Resource":{"Fn::GetAtt":["WebUIBuild0C1D8BF8","Arn"]}}],"Version":"2012-10-17"},"PolicyName":"PipelineBuildWebAppSourceCodeWebUIBuildCodePipelineActionRoleDefaultPolicy2BD5A9E5","Roles":[{"Ref":"PipelineBuildWebAppSourceCodeWebUIBuildCodePipelineActionRoleE47670F1"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Build_Web_App_Source_Code/WebUI_Build/CodePipelineActionRole/DefaultPolicy/Resource"}},"PipelineDeployWebAppSourceCodeWebUICodeUploadCodePipelineActionRoleB7E478D1":{"Type":"AWS::IAM::Role","Properties":{"AssumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"AWS":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::",{"Ref":"AWS::AccountId"},":root"]]}}}],"Version":"2012-10-17"}},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Deploy_Web_App_Source_Code/WebUI_Code_Upload/CodePipelineActionRole/Resource"}},"PipelineDeployWebAppSourceCodeWebUICodeUploadCodePipelineActionRoleDefaultPolicy9C43B0AB":{"Type":"AWS::IAM::Policy","Properties":{"PolicyDocument":{"Statement":[{"Action":["s3:DeleteObject*","s3:PutObject*","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::ImportValue":"WebUIStack:ExportsOutputFnGetAttnoce2devawsweatherappwebuibucket554E74B8Arn4C502BD9"},{"Fn::Join":["",[{"Fn::ImportValue":"WebUIStack:ExportsOutputFnGetAttnoce2devawsweatherappwebuibucket554E74B8Arn4C502BD9"},"/*"]]}]},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["PipelineArtifactsBucketC4BB9BE3","Arn"]},"/*"]]}]},{"Action":["kms:Decrypt","kms:DescribeKey"],"Effect":"Allow","Resource":{"Fn::GetAtt":["CustomPipelineArtifactsBucketKeyCFAAB9DA","Arn"]}}],"Version":"2012-10-17"},"PolicyName":"PipelineDeployWebAppSourceCodeWebUICodeUploadCodePipelineActionRoleDefaultPolicy9C43B0AB","Roles":[{"Ref":"PipelineDeployWebAppSourceCodeWebUICodeUploadCodePipelineActionRoleB7E478D1"}]},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/Pipeline/Deploy_Web_App_Source_Code/WebUI_Code_Upload/CodePipelineActionRole/DefaultPolicy/Resource"}},"CDKMetadata":{"Type":"AWS::CDK::Metadata","Properties":{"Modules":"aws-cdk=1.69.0,@aws-cdk/assets=1.69.0,@aws-cdk/aws-apigateway=1.69.0,@aws-cdk/aws-applicationautoscaling=1.69.0,@aws-cdk/aws-autoscaling=1.69.0,@aws-cdk/aws-autoscaling-common=1.69.0,@aws-cdk/aws-autoscaling-hooktargets=1.69.0,@aws-cdk/aws-cloudformation=1.69.0,@aws-cdk/aws-cloudwatch=1.69.0,@aws-cdk/aws-codebuild=1.69.0,@aws-cdk/aws-codedeploy=1.69.0,@aws-cdk/aws-codeguruprofiler=1.69.0,@aws-cdk/aws-codepipeline=1.69.0,@aws-cdk/aws-codepipeline-actions=1.69.0,@aws-cdk/aws-ec2=1.69.0,@aws-cdk/aws-ecr=1.69.0,@aws-cdk/aws-ecr-assets=1.69.0,@aws-cdk/aws-ecs=1.69.0,@aws-cdk/aws-elasticloadbalancingv2=1.69.0,@aws-cdk/aws-events=1.69.0,@aws-cdk/aws-events-targets=1.69.0,@aws-cdk/aws-iam=1.69.0,@aws-cdk/aws-kms=1.69.0,@aws-cdk/aws-lambda=1.69.0,@aws-cdk/aws-logs=1.69.0,@aws-cdk/aws-s3=1.69.0,@aws-cdk/aws-s3-assets=1.69.0,@aws-cdk/aws-servicediscovery=1.69.0,@aws-cdk/aws-sns=1.69.0,@aws-cdk/aws-sns-subscriptions=1.69.0,@aws-cdk/aws-sqs=1.69.0,@aws-cdk/aws-ssm=1.69.0,@aws-cdk/cloud-assembly-schema=1.69.0,@aws-cdk/core=1.69.0,@aws-cdk/custom-resources=1.69.0,@aws-cdk/cx-api=1.69.0,@aws-cdk/region-info=1.69.0,jsii-runtime=node.js/v12.18.3"},"Metadata":{"aws:cdk:path":"PipelineDeployingLambdaStack/CDKMetadata/Default"}}}}